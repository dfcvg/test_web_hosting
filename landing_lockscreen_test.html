<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연결 중</title>
    <style>
        body { font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #f8f9fa; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .msg { margin-top: 20px; font-size: 16px; color: #333; text-align: center; }
    </style>
</head>
<body>

    <div class="loader"></div>
    <div class="msg">
        <b id="status-title">페이지를 연결하고 있습니다</b><br>
        <span id="status-desc">잠금을 해제하면 자동으로 새로고침됩니다.</span>
    </div>

    <script>
        /**
         * 1. URL 파라미터에서 타겟 추출
         * 예: ?target=https%3A%2F%2Fmyapp.com%2Fdeeplink
         */
        const urlParams = new URLSearchParams(window.location.search);
        let targetUrl = urlParams.get('target');
        const isReloaded = urlParams.get('reloaded'); // 무한 루프 방지 플래그
    alert('b')
        if (targetUrl) {
            try { targetUrl = decodeURIComponent(targetUrl); } catch(e) {}
        }

        /**
         * 2. 크롬 브라우저 강제 호출 인텐트 실행 함수
         */
        function launchChromeIntent() {
            if (!targetUrl) return;

            // 현재 페이지 주소를 다시 구성 (reloaded 플래그 추가)
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('reloaded', 'true');

            // [핵심] 크롬 브라우저 패키지를 직접 호출하는 인텐트 주소
            // intent://[주소]#Intent;scheme=https;package=com.android.chrome;end
            const chromeIntent = `intent://${currentUrl.host}${currentUrl.pathname}${currentUrl.search}#Intent;scheme=https;package=com.android.chrome;end`;

            console.log("Calling Chrome Intent:", chromeIntent);
            window.location.href = chromeIntent;
        }

        /**
         * 3. 로직 실행
         */
        window.onload = () => {
            if (!targetUrl) {
                document.getElementById('status-title').innerText = "URL 정보가 없습니다.";
                return;
            }

            // 이미 인텐트로 호출된 상태(reloaded)이거나 화면이 보이면 딥링크 페이지 로드
            if (isReloaded === 'true' || document.visibilityState === 'visible') {
                // 여기서 실제 타겟(앱 딥링크 등)으로 이동
                window.location.href = targetUrl;
            }
        };

        /**
         * 4. 패턴 해제 시점에 크롬 브라우저 다시 깨우기
         */
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && isReloaded !== 'true') {
                // 패턴을 풀고 돌아온 시점: 시스템 인텐트로 크롬 브라우저를 강제 재실행
                launchChromeIntent();
            }
        });
    </script>
</body>
</html>
